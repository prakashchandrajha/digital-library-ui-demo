<!-- Action Buttons -->
<div class="bg-white p-6 rounded-xl shadow flex flex-wrap gap-4">
  <!-- Add Publication Button -->
  <button 
    (click)="openAddModal()"
    class="bg-gradient-to-r from-pink-500 to-orange-500 text-white px-6 py-3 rounded-lg shadow hover:from-pink-600 hover:to-orange-600 transition">
    + Add Publication
  </button>

  <!-- Category Buttons -->
  <ng-container *ngFor="let category of categories">
    <button 
      (click)="loadPublicationsByCategory(category.id)"
      [ngClass]="{'bg-pink-600 text-white': selectedCategoryId === category.id, 'bg-gray-200 text-gray-800': selectedCategoryId !== category.id}"
      class="px-6 py-3 rounded-lg shadow hover:bg-pink-500 hover:text-white transition">
      {{ category.name }}
    </button>
  </ng-container>
</div>

<!-- Publication Type Buttons -->
<div *ngIf="selectedCategoryId" class="bg-white p-6 rounded-xl shadow flex flex-wrap gap-4 mt-4">
  <ng-container *ngFor="let type of publicationTypes">
    <button 
      (click)="loadPublicationsByCategoryAndType(selectedCategoryId, type.id)"
      [ngClass]="{'bg-blue-600 text-white': selectedTypeId === type.id, 'bg-gray-200 text-gray-800': selectedTypeId !== type.id}"
      class="px-6 py-3 rounded-lg shadow hover:bg-blue-500 hover:text-white transition">
      {{ type.name }}
    </button>
  </ng-container>
</div>

<!-- Publication Table -->
<div *ngIf="selectedCategoryId" class="mt-6">
  <h3 class="text-2xl font-bold mb-4 text-gray-800">Publications</h3>
  <div class="overflow-x-auto bg-white rounded-lg shadow">
    <table class="min-w-full leading-normal">
      <thead>
        <tr>
          <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            Title
          </th>
          <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            Description
          </th>
          <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            Actions
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pub of publications">
          <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
            <p class="text-gray-900 whitespace-no-wrap">{{ pub.title }}</p>
          </td>
          <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
            <p class="text-gray-900 whitespace-no-wrap">{{ pub.description }}</p>
          </td>
          <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
            <button (click)="openEditModal(pub)" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mr-2">Update</button>
            <button (click)="deletePublication(pub.id)" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="publications.length === 0" class="mt-6 text-center text-gray-500">
    <p>No publications found for this category.</p>
  </div>
</div>


<!-- Modal -->
<div *ngIf="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-[600px] relative max-h-[90vh] overflow-auto">

    <!-- Close Button -->
    <button 
      class="absolute top-3 right-3 text-gray-500 hover:text-gray-800"
      (click)="closeModal()"
    >âœ–</button>

    <h2 class="text-xl font-bold mb-4 text-pink-600">{{ isEditMode ? 'Edit' : 'Add New' }} Publication</h2>

    <!-- Success / Error Messages -->
    <div *ngIf="successMessage" class="bg-green-100 text-green-800 p-3 rounded mb-3">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="bg-red-100 text-red-800 p-3 rounded mb-3">
      {{ errorMessage }}
    </div>

    <!-- Reactive Form -->
    <form [formGroup]="publicationForm" (ngSubmit)="submitPublication()" class="space-y-4" novalidate>

      <!-- Category -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
        <select formControlName="categoryId" class="border p-2 rounded w-full">
          <option value="">-- Select Category --</option>
          <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
        </select>
        <p *ngIf="submitted && publicationForm.get('categoryId')?.errors" class="text-red-600 text-sm">
          Category is required.
        </p>
      </div>

      <!-- Publication Type -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Publication Type</label>
        <select formControlName="typeId" class="border p-2 rounded w-full">
          <option value="">-- Select Type --</option>
          <option *ngFor="let type of publicationTypes" [value]="type.id">{{ type.name }}</option>
        </select>
        <p *ngIf="submitted && publicationForm.get('typeId')?.errors" class="text-red-600 text-sm">
          Type is required.
        </p>
      </div>

      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
        <input type="text" formControlName="title" class="border p-2 rounded w-full" />
        <p *ngIf="submitted && publicationForm.get('title')?.errors" class="text-red-600 text-sm">
          Title is required.
        </p>
      </div>

      <!-- Description -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
        <textarea formControlName="description" rows="3" class="border p-2 rounded w-full"></textarea>
        <p *ngIf="submitted && publicationForm.get('description')?.errors" class="text-red-600 text-sm">
          Description is required.
        </p>
      </div>

      <!-- Cover Image -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cover Image</label>
        <input type="file" (change)="onCoverImageSelected($event)" accept="image/*" />
        <p *ngIf="submitted && !isEditMode && !coverImageFile" class="text-red-600 text-sm">
          Cover image is required.
        </p>
      </div>

      <!-- PDF File -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">PDF File</label>
        <input type="file" (change)="onPdfSelected($event)" accept="application/pdf" />
        <p *ngIf="submitted && !isEditMode && !pdfFile" class="text-red-600 text-sm">
          PDF file is required.
        </p>
      </div>

      <div class="flex justify-end gap-3 pt-3">
        <button type="button" (click)="closeModal()" class="px-4 py-2 border rounded">Cancel</button>
        <button type="submit" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700">Save</button>
      </div>
    </form>
  </div>
</div>
